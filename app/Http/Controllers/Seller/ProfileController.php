<?phpnamespace App\Http\Controllers\Seller;use App\Http\Requests\SellerProfileRequest;use App\Models\User;use App\Models\SellerCategoryPreference;use App\Models\Category;use Illuminate\Http\Request;use Auth;use Hash;class ProfileController extends Controller{    /**     * Display a listing of the resource.     *     * @return \Illuminate\Http\Response     */    public function index()    {        $user = Auth::user();        $addresses = $user->addresses;         $preferences = SellerCategoryPreference::where('user_id', $user->id)                    ->pluck('status', 'category_id')->all();        $categories = Category::where('parent_id', 0)                    ->where('digital', 0)                    ->get();        return view('seller.profile.index', compact('user', 'addresses', 'categories', 'preferences'));    }    /**     * Update the specified resource in storage.     *     * @param  \Illuminate\Http\Request  $request     * @param  int  $id     * @return \Illuminate\Http\Response     */    public function update(SellerProfileRequest $request , $id)    {        if(env('DEMO_MODE') == 'On'){            flash(translate('Sorry! the action is not permitted in demo '))->error();            return back();        }        $user = User::findOrFail($id);        $user->name = $request->name;        $user->phone = $request->phone;        if($request->new_password != null && ($request->new_password == $request->confirm_password)){            $user->password = Hash::make($request->new_password);        }                $user->avatar_original = $request->photo;        $shop = $user->shop;        if($shop){            $shop->cash_on_delivery_status = $request->cash_on_delivery_status;            $shop->bank_payment_status = $request->bank_payment_status;            $shop->bank_name = $request->bank_name;            $shop->bank_acc_name = $request->bank_acc_name;            $shop->bank_acc_no = $request->bank_acc_no;            $shop->bank_routing_no = $request->bank_routing_no;            $shop->save();        }        $user->save();        flash(translate('Your Profile has been updated successfully!'))->success();        return back();    }        public function updateCategoryPreferences(Request $request)        {            $user = Auth::user();            $preferences = $request->get('categories', []);                    foreach ($preferences as $categoryId => $isEnabled) {                // Here you either update existing preferences or create new ones                \App\Models\SellerCategoryPreference::updateOrCreate(                    ['user_id' => $user->id, 'category_id' => $categoryId],                    ['status' => $isEnabled]                );            }            flash('Category preferences updated successfully.')->success();            return back();    }}